datasource db {
  url      = env("DATABASE_URL")
  provider = "mongodb"
  // relationMode = "prisma"
}

generator db {
  provider = "go run github.com/steebchen/prisma-client-go"
}

model User {
  id        String   @id @default(cuid()) @map("_id")
  authId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  views         VideoView[]
  settings      UserSettings?
  subscriptions UserSubscription[]

  // @@index([authId], name: "authId")
  @@map("users")
}

model UserSettings {
  id        String   @id @default(cuid()) @map("_id")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String @unique

  sponsorBlockEnabled    Boolean  @default(true)
  sponsorBlockCategories String[] @default([])

  @@map("user_settings")
}

model Channel {
  id        String   @id @map("_id")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  url         String
  title       String
  thumbnail   String?
  description String  @db.String

  videos        Video[]
  subscriptions UserSubscription[]

  @@map("channels")
}

model Video {
  id        String   @id @map("_id")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  url         String
  title       String
  duration    Int     @default(0)
  thumbnail   String?
  description String  @db.String

  views     VideoView[]
  channel   Channel     @relation(fields: [channelId], references: [id], onDelete: Cascade)
  channelId String

  @@index([channelId], name: "channelId")
  @@map("videos")
}

model VideoView {
  id        String   @id @default(cuid()) @map("_id")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId  String
  video   Video  @relation(fields: [videoId], references: [id])
  videoId String

  progress Int @default(0)

  @@index([userId], name: "userId")
  @@index([videoId], name: "videoId")
  @@map("video_views")
}

model UserSubscription {
  id        String   @id @default(cuid()) @map("_id")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  isFavorite Boolean @default(false)

  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  channel   Channel @relation(fields: [channelId], references: [id], onDelete: Cascade)
  channelId String

  @@index([userId], name: "userId")
  @@index([channelId], name: "channelId")
  @@map("user_subscriptions")
}

model Session {
  id        String   @id @map("_id")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  lastUsed  DateTime @default(now())

  expiresAt DateTime
  userId    String?
  meta      Json?

  authId         String?
  accessToken    String?   @db.String
  refreshToken   String?   @db.String
  tokenExpiresAt DateTime?

  @@index([userId], name: "userId")
  @@index([authId], name: "authId")
  @@index([expiresAt], name: "expiresAt")
  @@index([tokenExpiresAt], name: "tokenExpiresAt")
  @@map("sessions")
}
